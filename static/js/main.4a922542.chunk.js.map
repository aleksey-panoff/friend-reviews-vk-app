{"version":3,"sources":["utils/getCommentsFromVk.js","utils/getComments.js","utils/pluralForm.js","App.js","index.js"],"names":["getCommentsFromVk","access_token","a","offset","bridge","send","method","request_id","params","group_id","topic_id","count","extended","v","response","nextItems","items","getComments","fromCache","cachedComments","pluralForm","forms","n","App","useState","comments","setComments","loading","setLoading","useEffect","app_id","scope","commentsRes","user_ids","map","item","from_id","join","need_sign","friendsRes","friends","filter","friend_status","user_id","console","log","length","friendsComments","includes","fields","usersRes","res","reduce","acc","comment","user","find","id","subscribe","detail","type","data","schemeAttribute","document","createAttribute","value","scheme","body","attributes","setNamedItem","fetchData","popout","size","renderMoreButton","href","target","activePanel","icon","action","header","mode","attachments","key","before","src","photo_50","description","text","className","attachment","photo","sizes","url","width","height","multiline","bottomContent","first_name","last_name","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.4a922542.chunk.js","sourcesContent":["import bridge from '@vkontakte/vk-bridge'\n\nconst COUNT = 100\n\nconst getCommentsFromVk = async (access_token, offset = 0) => {\n  const { response } = await bridge.send('VKWebAppCallAPIMethod', {\n    method: 'board.getComments',\n    request_id: '1',\n    params: {\n      group_id: 71768893, // https://vk.com/academy_mebel29\n      topic_id: 30336271, // https://vk.com/topic-71768893_30336271\n      count: COUNT,\n      offset,\n      extended: 0,\n      v: '5.120',\n      access_token,\n    }\n  })\n\n  const hasMore = response.count > offset + COUNT\n  if (hasMore) {\n    const nextItems = await getCommentsFromVk(access_token, offset + COUNT)\n    return [...response.items, ...nextItems]\n  }\n\n  return response.items\n}\n\nexport default getCommentsFromVk\n","import cachedComments from './cachedComments.json'\nimport getCommentsFromVk from './getCommentsFromVk'\n\nconst getComments = async (access_token, fromCache) => {\n  if (fromCache) return cachedComments\n  return getCommentsFromVk(access_token)\n}\n\nexport default getComments\n","const pluralForm = (forms, n) => {\n  if (n % 10 === 1 && n % 100 !== 11) return forms[0]\n  return forms[n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2]\n}\n\nexport default pluralForm\n","import React, { useState, useEffect } from 'react'\nimport bridge from '@vkontakte/vk-bridge'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport getComments from './utils/getComments'\nimport {\n\tGroup,\n\tPanel,\n\tPanelHeader,\n\tScreenSpinner,\n\tView,\n\tLink,\n\tButton,\n\tList,\n\tCell,\n\tAvatar,\n\tPlaceholder,\n\tDiv,\n\tHeader,\n} from '@vkontakte/vkui'\nimport Icon56UsersOutline from '@vkontakte/icons/dist/56/users_outline'\nimport pluralForm from './utils/pluralForm'\nimport './App.css'\n\nconst App = () => {\n\tconst [comments, setComments] = useState(null)\n\tconst [loading, setLoading] = useState(true)\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t})\n\n\t\tasync function fetchData() {\n\t\t\tconst { access_token } = await bridge.send('VKWebAppGetAuthToken', {\n\t\t\t\tapp_id: 7530996,\n\t\t\t\tscope: 'friends'\n\t\t\t})\n\n\t\t\tconst commentsRes = await getComments(access_token, true)\n\t\t\tconst friendsRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'friends.areFriends',\n\t\t\t\trequest_id: '1',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: commentsRes.map(item => item.from_id).join(','),\n\t\t\t\t\tneed_sign: 0,\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconst friends = friendsRes.response\n\t\t\t\t.filter(item => item.friend_status === 3)\n\t\t\t\t.map(item => item.user_id)\n\n\t\t\tconsole.log('friends', friends)\n\n\t\t\tif (friends.length === 0) {\n\t\t\t\tsetComments([])\n\t\t\t\tsetLoading(false)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst friendsComments = commentsRes.filter(item => friends.includes(item.from_id))\n\t\t\tconsole.log('friendsComments', friendsComments)\n\n\t\t\tconst usersRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'users.get',\n\t\t\t\trequest_id: '2',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: friends.join(','),\n\t\t\t\t\tfields: 'photo_50',\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconsole.log('usersRes', usersRes)\n\n\t\t\tconst res = friendsComments.reduce((acc, comment) => ([\n\t\t\t\t...acc, {\n\t\t\t\t\tuser: usersRes.response.find(item => item.id === comment.from_id),\n\t\t\t\t\tcomment,\n\t\t\t\t}\n\t\t\t]), [])\n\t\t\tconsole.log('res', res)\n\n\t\t\tsetComments(res)\n\t\t\tsetLoading(false)\n\t\t}\n\n\t\tfetchData()\n\t}, [])\n\n\tconst popout = loading ? <ScreenSpinner size='large' /> : null\n\n\tconst renderMoreButton = (size) => (\n\t\t<Button\n\t\t\thref='https://vk.com/topic-71768893_30336271'\n\t\t\tsize={ size }\n\t\t\ttarget='_parent'\n\t\t>\n\t\t\tПосмотреть все отзывы\n\t\t</Button>\n\t)\n\n\treturn (\n\t\t<View activePanel='home' popout={ popout }>\n\t\t\t<Panel id='home'>\n\t\t\t\t<PanelHeader>Отзывы от ваших друзей</PanelHeader>\n\t\t\t\t{ comments !== null && comments.length === 0 && (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <Icon56UsersOutline /> }\n\t\t\t\t\t\taction={ renderMoreButton('l') }\n\t\t\t\t\t>\n\t\t\t\t\t\tОтзывов от друзей пока нет\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\n\t\t\t\t{ comments !== null && comments.length > 0 && (\n\t\t\t\t\t<Group\n\t\t\t\t\t\theader={\n\t\t\t\t\t\t\t<Header mode='secondary'>\n\t\t\t\t\t\t\t\tНайдено { comments.length } { pluralForm(['отзыв', 'отзыва', 'отзывов'], comments.length) }\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<List>\n\t\t\t\t\t\t\t{ comments.map(({ user, comment }) => {\n\t\t\t\t\t\t\t\tconst attachments = (comment.attachments || []).filter(item => item.type === 'photo')\n\t\t\t\t\t\t\t\tconsole.log('att', comment.attachments)\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\t\t\t\tkey={ comment.id }\n\t\t\t\t\t\t\t\t\t\tbefore={\n\t\t\t\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={ user.photo_50 }\n\t\t\t\t\t\t\t\t\t\t\t\tsize={ 50 }\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsize='l'\n\t\t\t\t\t\t\t\t\t\tdescription={\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{ comment.text }</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className='attachments'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.map(attachment => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst size = attachment.photo.sizes.find(item => item.type === 'm')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!size) return null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={ size.url }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth={size.width}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\theight={size.height}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tmultiline={ true }\n\t\t\t\t\t\t\t\t\t\tbottomContent={\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={ `http://vk.com/topic-71768893_30336271?post=${ comment.id }` }\n\t\t\t\t\t\t\t\t\t\t\t\ttarget='_parent'\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tОткрыть\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ user.first_name } { user.last_name }\n\t\t\t\t\t\t\t\t\t</Cell>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t</List>\n\t\t\t\t\t\t<Div>\n\t\t\t\t\t\t\t{ renderMoreButton('xl') }\n\t\t\t\t\t\t</Div>\n\t\t\t\t\t</Group>\n\t\t\t\t) }\n\t\t\t</Panel>\n\t\t</View>\n\t)\n}\n\nexport default App\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}