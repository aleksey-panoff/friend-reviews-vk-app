{"version":3,"sources":["utils/getCommentsFromVk.js","utils/getComments.js","App.js","index.js"],"names":["getCommentsFromVk","access_token","a","offset","bridge","send","method","request_id","params","group_id","topic_id","count","extended","v","response","nextItems","items","getComments","fromCache","cachedComments","App","useState","comments","setComments","loading","setLoading","useEffect","app_id","scope","commentsRes","user_ids","map","item","from_id","join","need_sign","friendsRes","friends","filter","friend_status","user_id","console","log","length","friendsComments","includes","fields","usersRes","res","reduce","acc","comment","user","find","id","subscribe","detail","type","data","schemeAttribute","document","createAttribute","value","scheme","body","attributes","setNamedItem","fetchData","popout","size","renderMoreButton","href","target","activePanel","icon","action","key","before","src","photo_50","description","text","multiline","bottomContent","first_name","last_name","className","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.3ef7fa74.chunk.js","sourcesContent":["import bridge from '@vkontakte/vk-bridge'\n\nconst COUNT = 100\n\nconst getCommentsFromVk = async (access_token, offset = 0) => {\n  const { response } = await bridge.send('VKWebAppCallAPIMethod', {\n    method: 'board.getComments',\n    request_id: '1',\n    params: {\n      group_id: 71768893, // https://vk.com/academy_mebel29\n      topic_id: 30336271, // https://vk.com/topic-71768893_30336271\n      count: COUNT,\n      offset,\n      extended: 0,\n      v: '5.120',\n      access_token,\n    }\n  })\n\n  const hasMore = response.count > offset + COUNT\n  if (hasMore) {\n    const nextItems = await getCommentsFromVk(access_token, offset + COUNT)\n    return [...response.items, ...nextItems]\n  }\n\n  return response.items\n}\n\nexport default getCommentsFromVk\n","import cachedComments from './cachedComments.json'\nimport getCommentsFromVk from './getCommentsFromVk'\n\nconst getComments = async (access_token, fromCache) => {\n  if (fromCache) return cachedComments\n  return getCommentsFromVk(access_token)\n}\n\nexport default getComments\n","import React, { useState, useEffect } from 'react'\nimport bridge from '@vkontakte/vk-bridge'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport getComments from './utils/getComments'\nimport {\n\tGroup,\n\tPanel,\n\tPanelHeader,\n\tScreenSpinner,\n\tView,\n\tLink,\n\tButton,\n\tList,\n\tCell,\n\tAvatar,\n\tPlaceholder,\n\tDiv,\n} from '@vkontakte/vkui'\nimport Icon56UsersOutline from '@vkontakte/icons/dist/56/users_outline'\nimport './App.css'\n\nconst App = () => {\n\tconst [comments, setComments] = useState(null)\n\tconst [loading, setLoading] = useState(true)\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t})\n\n\t\tasync function fetchData() {\n\t\t\tconst { access_token } = await bridge.send('VKWebAppGetAuthToken', {\n\t\t\t\tapp_id: 7530996,\n\t\t\t\tscope: 'friends'\n\t\t\t})\n\n\t\t\tconst commentsRes = await getComments(access_token, true)\n\t\t\tconst friendsRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'friends.areFriends',\n\t\t\t\trequest_id: '1',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: commentsRes.map(item => item.from_id).join(','),\n\t\t\t\t\tneed_sign: 0,\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconst friends = friendsRes.response\n\t\t\t\t.filter(item => item.friend_status === 3)\n\t\t\t\t.map(item => item.user_id)\n\n\t\t\tconsole.log('friends', friends)\n\n\t\t\tif (friends.length === 0) {\n\t\t\t\tsetComments([])\n\t\t\t\tsetLoading(false)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst friendsComments = commentsRes.filter(item => friends.includes(item.from_id))\n\t\t\tconsole.log('friendsComments', friendsComments)\n\n\t\t\tconst usersRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'users.get',\n\t\t\t\trequest_id: '2',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: friends.join(','),\n\t\t\t\t\tfields: 'photo_50',\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconsole.log('usersRes', usersRes)\n\n\t\t\tconst res = friendsComments.reduce((acc, comment) => ([\n\t\t\t\t...acc, {\n\t\t\t\t\tuser: usersRes.response.find(item => item.id === comment.from_id),\n\t\t\t\t\tcomment,\n\t\t\t\t}\n\t\t\t]), [])\n\t\t\tconsole.log('res', res)\n\n\t\t\tsetComments(res)\n\t\t\tsetLoading(false)\n\t\t}\n\n\t\tfetchData()\n\t}, [])\n\n\tconst popout = loading ? <ScreenSpinner size='large' /> : null\n\n\tconst renderMoreButton = (size) => (\n\t\t<Button\n\t\t\thref='https://vk.com/topic-71768893_30336271'\n\t\t\tsize={ size }\n\t\t\ttarget='_parent'\n\t\t>\n\t\t\tПосмотреть все отзывы\n\t\t</Button>\n\t)\n\n\treturn (\n\t\t<View activePanel='home' popout={ popout }>\n\t\t\t<Panel id='home'>\n\t\t\t\t<PanelHeader>Отзывы от ваших друзей</PanelHeader>\n\t\t\t\t{ comments !== null && comments.length === 0 && (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <Icon56UsersOutline /> }\n\t\t\t\t\t\taction={ renderMoreButton('l') }\n\t\t\t\t\t>\n\t\t\t\t\t\tОтзывов от друзей пока нет\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\n\t\t\t\t{ comments !== null && comments.length > 0 && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Group>\n\t\t\t\t\t\t\t<List>\n\t\t\t\t\t\t\t\t{ comments.map(({ user, comment }) => (\n\t\t\t\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\t\t\t\tkey={ comment.id }\n\t\t\t\t\t\t\t\t\t\tbefore={\n\t\t\t\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={ user.photo_50 }\n\t\t\t\t\t\t\t\t\t\t\t\tsize={ 50 }\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsize='l'\n\t\t\t\t\t\t\t\t\t\tdescription={ comment.text }\n\t\t\t\t\t\t\t\t\t\tmultiline={ true }\n\t\t\t\t\t\t\t\t\t\tbottomContent={\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={ `http://vk.com/topic-71768893_30336271?post=${ comment.id }` }\n\t\t\t\t\t\t\t\t\t\t\t\ttarget='_parent'\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tОткрыть\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ user.first_name } { user.last_name }\n\t\t\t\t\t\t\t\t\t</Cell>\n\t\t\t\t\t\t\t\t)) }\n\t\t\t\t\t\t\t</List>\n\t\t\t\t\t\t\t<Div className='more-button'>{ renderMoreButton('xl') }</Div>\n\t\t\t\t\t\t</Group>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</Panel>\n\t\t</View>\n\t)\n}\n\nexport default App\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}