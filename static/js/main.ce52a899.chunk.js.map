{"version":3,"sources":["utils/pluralForm.js","App.js","index.js"],"names":["pluralForm","forms","n","App","useState","comments","loading","setLoading","useEffect","a","console","log","bridge","send","app_id","group_id","scope","access_token","method","request_id","params","type","code","v","widgetRes","subscribe","detail","data","schemeAttribute","document","createAttribute","value","scheme","body","attributes","setNamedItem","fetchData","popout","size","renderMoreButton","href","target","activePanel","id","length","icon","action","header","mode","map","user","comment","attachments","filter","item","key","before","src","photo_100","description","text","className","attachment","photo","sizes","find","url","width","height","multiline","bottomContent","first_name","last_name","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.ce52a899.chunk.js","sourcesContent":["const pluralForm = (forms, n) => {\n  if (n % 10 === 1 && n % 100 !== 11) return forms[0]\n  return forms[n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2]\n}\n\nexport default pluralForm\n","import React, { useState, useEffect } from 'react'\nimport bridge from '@vkontakte/vk-bridge'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport getComments from './utils/getComments'\nimport {\n\tGroup,\n\tPanel,\n\tPanelHeader,\n\tScreenSpinner,\n\tView,\n\tLink,\n\tButton,\n\tList,\n\tCell,\n\tAvatar,\n\tPlaceholder,\n\tDiv,\n\tHeader,\n} from '@vkontakte/vkui'\nimport Icon56UsersOutline from '@vkontakte/icons/dist/56/users_outline'\nimport pluralForm from './utils/pluralForm'\nimport './App.css'\n\nconst App = () => {\n\tconst [comments, setComments] = useState(null)\n\tconst [loading, setLoading] = useState(true)\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t})\n\n\t\tasync function fetchData() {\n\t\t\tconsole.log(':(')\n\t\t\tconst { access_token } = await bridge.send('VKWebAppGetCommunityToken', {\n\t\t\t\tapp_id: 7530996,\n\t\t\t\tgroup_id: 71768893,\n\t\t\t\tscope: 'app_widget'\n\t\t\t})\n\n\t\t\tconsole.log('access_token', access_token)\n\n\t\t\tconst widgetRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'appWidgets.update',\n\t\t\t\trequest_id: '40',\n\t\t\t\tparams: {\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tcode: `return {\n\t\t\t\t\t\t\"title\": \"Цитата дня\",\n\t\t\t\t\t\t\"title_url\": \"https://google.com\",\n\t\t\t\t\t\t\"title_counter\": 42,\n\t\t\t\t\t\t\"more\": \"Читать все цитаты\",\n\t\t\t\t\t\t\"more_url\": \"https://google.com\",\n\t\t\t\t\t\t\"text\": \"«Нам нужно гордиться»\",\n\t\t\t\t\t\t\"descr\": \"Дэвид Кэмерон о победе сторонников выхода страны\\\\n из Евросоюза на референдуме\",\n\t\t\t\t\t}`,\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconsole.log('widgetRes', widgetRes)\n\n\t\t\t// const { access_token } = await bridge.send('VKWebAppGetAuthToken', {\n\t\t\t// \tapp_id: 7530996,\n\t\t\t// \tscope: 'friends'\n\t\t\t// })\n\n\t\t\t// const commentsRes = await getComments(access_token, true)\n\t\t\t// const friendsRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t// \tmethod: 'friends.areFriends',\n\t\t\t// \trequest_id: '1',\n\t\t\t// \tparams: {\n\t\t\t// \t\tuser_ids: commentsRes.map(item => item.from_id).join(','),\n\t\t\t// \t\tneed_sign: 0,\n\t\t\t// \t\tv: '5.120',\n\t\t\t// \t\taccess_token,\n\t\t\t// \t}\n\t\t\t// })\n\t\t\t// const friends = friendsRes.response\n\t\t\t// \t.filter(item => item.friend_status === 3)\n\t\t\t// \t.map(item => item.user_id)\n\t\t\t//\n\t\t\t// console.log('friends', friends)\n\t\t\t//\n\t\t\t// if (friends.length === 0) {\n\t\t\t// \tsetComments([])\n\t\t\t// \tsetLoading(false)\n\t\t\t// \treturn\n\t\t\t// }\n\t\t\t//\n\t\t\t// const friendsComments = commentsRes.filter(item => friends.includes(item.from_id))\n\t\t\t// console.log('friendsComments', friendsComments)\n\t\t\t//\n\t\t\t// const usersRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t// \tmethod: 'users.get',\n\t\t\t// \trequest_id: '2',\n\t\t\t// \tparams: {\n\t\t\t// \t\tuser_ids: friends.join(','),\n\t\t\t// \t\tfields: 'photo_100',\n\t\t\t// \t\tv: '5.120',\n\t\t\t// \t\taccess_token,\n\t\t\t// \t}\n\t\t\t// })\n\t\t\t// console.log('usersRes', usersRes)\n\t\t\t//\n\t\t\t// const res = friendsComments.reduce((acc, comment) => ([\n\t\t\t// \t...acc, {\n\t\t\t// \t\tuser: usersRes.response.find(item => item.id === comment.from_id),\n\t\t\t// \t\tcomment,\n\t\t\t// \t}\n\t\t\t// ]), [])\n\t\t\t// console.log('res', res)\n\t\t\t//\n\t\t\t// setComments(res)\n\t\t\tsetLoading(false)\n\t\t}\n\n\t\tfetchData()\n\t}, [])\n\n\tconst popout = loading ? <ScreenSpinner size='large' /> : null\n\n\tconst renderMoreButton = (size) => (\n\t\t<Button\n\t\t\thref='https://vk.com/topic-71768893_30336271'\n\t\t\tsize={ size }\n\t\t\ttarget='_parent'\n\t\t>\n\t\t\tПосмотреть все отзывы\n\t\t</Button>\n\t)\n\n\treturn (\n\t\t<View activePanel='home' popout={ popout }>\n\t\t\t<Panel id='home'>\n\t\t\t\t<PanelHeader>Отзывы от ваших друзей</PanelHeader>\n\t\t\t\t{ comments !== null && comments.length === 0 && (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <Icon56UsersOutline /> }\n\t\t\t\t\t\taction={ renderMoreButton('l') }\n\t\t\t\t\t>\n\t\t\t\t\t\tОтзывов от друзей пока нет\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\n\t\t\t\t{ comments !== null && comments.length > 0 && (\n\t\t\t\t\t<Group\n\t\t\t\t\t\theader={\n\t\t\t\t\t\t\t<Header mode='secondary'>\n\t\t\t\t\t\t\t\tНайдено { comments.length } { pluralForm(['отзыв', 'отзыва', 'отзывов'], comments.length) }\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<List>\n\t\t\t\t\t\t\t{ comments.map(({ user, comment }) => {\n\t\t\t\t\t\t\t\tconst attachments = (comment.attachments || []).filter(item => item.type === 'photo')\n\t\t\t\t\t\t\t\tconsole.log('att', comment.attachments)\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\t\t\t\tkey={ comment.id }\n\t\t\t\t\t\t\t\t\t\tbefore={\n\t\t\t\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={ user.photo_100 }\n\t\t\t\t\t\t\t\t\t\t\t\tsize={ 50 }\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsize='l'\n\t\t\t\t\t\t\t\t\t\tdescription={\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{ comment.text }</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className='attachments'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.map(attachment => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst size = attachment.photo.sizes.find(item => item.type === 'x')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!size) return null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={ size.url }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth={ size.width / 2 }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\theight={ size.height / 2 }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tmultiline={ true }\n\t\t\t\t\t\t\t\t\t\tbottomContent={\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={ `http://vk.com/topic-71768893_30336271?post=${ comment.id }` }\n\t\t\t\t\t\t\t\t\t\t\t\ttarget='_parent'\n\t\t\t\t\t\t\t\t\t\t\t\tclassName='open-comment'\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tОткрыть\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ user.first_name } { user.last_name }\n\t\t\t\t\t\t\t\t\t</Cell>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t</List>\n\t\t\t\t\t\t<Div>\n\t\t\t\t\t\t\t{ renderMoreButton('xl') }\n\t\t\t\t\t\t</Div>\n\t\t\t\t\t</Group>\n\t\t\t\t) }\n\t\t\t</Panel>\n\t\t</View>\n\t)\n}\n\nexport default App\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}