{"version":3,"sources":["utils/getCommentsFromVk.js","utils/getComments.js","utils/pluralForm.js","App.js","index.js"],"names":["getCommentsFromVk","access_token","a","offset","bridge","send","method","request_id","params","group_id","topic_id","count","extended","v","response","nextItems","items","getComments","fromCache","cachedComments","pluralForm","forms","n","App","useState","comments","setComments","loading","setLoading","useEffect","app_id","scope","type","code","commentsRes","user_ids","map","item","from_id","join","need_sign","friendsRes","friends","filter","friend_status","user_id","console","log","length","friendsComments","includes","fields","usersRes","res","reduce","acc","comment","user","find","id","subscribe","detail","data","schemeAttribute","document","createAttribute","value","scheme","body","attributes","setNamedItem","fetchData","popout","size","renderMoreButton","href","target","activePanel","icon","action","header","mode","attachments","key","before","src","photo_100","description","text","className","attachment","photo","sizes","url","width","height","multiline","bottomContent","first_name","last_name","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.afd14ad0.chunk.js","sourcesContent":["import bridge from '@vkontakte/vk-bridge'\n\nconst COUNT = 100\n\nconst getCommentsFromVk = async (access_token, offset = 0) => {\n  const { response } = await bridge.send('VKWebAppCallAPIMethod', {\n    method: 'board.getComments',\n    request_id: '1',\n    params: {\n      group_id: 71768893, // https://vk.com/academy_mebel29\n      topic_id: 30336271, // https://vk.com/topic-71768893_30336271\n      count: COUNT,\n      offset,\n      extended: 0,\n      v: '5.120',\n      access_token,\n    }\n  })\n\n  const hasMore = response.count > offset + COUNT\n  if (hasMore) {\n    const nextItems = await getCommentsFromVk(access_token, offset + COUNT)\n    return [...response.items, ...nextItems]\n  }\n\n  return response.items\n}\n\nexport default getCommentsFromVk\n","import cachedComments from './cachedComments.json'\nimport getCommentsFromVk from './getCommentsFromVk'\n\nconst getComments = async (access_token, fromCache) => {\n  if (fromCache) return cachedComments\n  return getCommentsFromVk(access_token)\n}\n\nexport default getComments\n","const pluralForm = (forms, n) => {\n  if (n % 10 === 1 && n % 100 !== 11) return forms[0]\n  return forms[n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2]\n}\n\nexport default pluralForm\n","import React, { useState, useEffect } from 'react'\nimport bridge from '@vkontakte/vk-bridge'\nimport '@vkontakte/vkui/dist/vkui.css'\nimport getComments from './utils/getComments'\nimport {\n\tGroup,\n\tPanel,\n\tPanelHeader,\n\tScreenSpinner,\n\tView,\n\tLink,\n\tButton,\n\tList,\n\tCell,\n\tAvatar,\n\tPlaceholder,\n\tDiv,\n\tHeader,\n} from '@vkontakte/vkui'\nimport Icon56UsersOutline from '@vkontakte/icons/dist/56/users_outline'\nimport pluralForm from './utils/pluralForm'\nimport './App.css'\n\nconst App = () => {\n\tconst [comments, setComments] = useState(null)\n\tconst [loading, setLoading] = useState(true)\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t})\n\n\t\tasync function fetchData() {\n\t\t\tconst { access_token } = await bridge.send('VKWebAppGetCommunityToken', {\n\t\t\t\tapp_id: 7530996,\n\t\t\t\tgroup_id: 71768893,\n\t\t\t\tscope: 'app_widget'\n\t\t\t})\n\n\t\t\tawait bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'appWidgets.update',\n\t\t\t\trequest_id: '40',\n\t\t\t\tparams: {\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tcode: `return {\n\t\t\t\t\t\t\"title\": \"Цитата дня\",\n\t\t\t\t\t\t\"title_url\": \"https://google.com\",\n\t\t\t\t\t\t\"title_counter\": 42,\n\t\t\t\t\t\t\"more\": \"Читать все цитаты\",\n\t\t\t\t\t\t\"more_url\": \"https://google.com\",\n\t\t\t\t\t\t\"text\": \"«Нам нужно гордиться»\",\n\t\t\t\t\t\t\"descr\": \"Дэвид Кэмерон о победе сторонников выхода страны\\\\n из Евросоюза на референдуме\",\n\t\t\t\t\t}`,\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// const { access_token } = await bridge.send('VKWebAppGetAuthToken', {\n\t\t\t// \tapp_id: 7530996,\n\t\t\t// \tscope: 'friends'\n\t\t\t// })\n\n\t\t\tconst commentsRes = await getComments(access_token, true)\n\t\t\tconst friendsRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'friends.areFriends',\n\t\t\t\trequest_id: '1',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: commentsRes.map(item => item.from_id).join(','),\n\t\t\t\t\tneed_sign: 0,\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconst friends = friendsRes.response\n\t\t\t\t.filter(item => item.friend_status === 3)\n\t\t\t\t.map(item => item.user_id)\n\n\t\t\tconsole.log('friends', friends)\n\n\t\t\tif (friends.length === 0) {\n\t\t\t\tsetComments([])\n\t\t\t\tsetLoading(false)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst friendsComments = commentsRes.filter(item => friends.includes(item.from_id))\n\t\t\tconsole.log('friendsComments', friendsComments)\n\n\t\t\tconst usersRes = await bridge.send('VKWebAppCallAPIMethod', {\n\t\t\t\tmethod: 'users.get',\n\t\t\t\trequest_id: '2',\n\t\t\t\tparams: {\n\t\t\t\t\tuser_ids: friends.join(','),\n\t\t\t\t\tfields: 'photo_100',\n\t\t\t\t\tv: '5.120',\n\t\t\t\t\taccess_token,\n\t\t\t\t}\n\t\t\t})\n\t\t\tconsole.log('usersRes', usersRes)\n\n\t\t\tconst res = friendsComments.reduce((acc, comment) => ([\n\t\t\t\t...acc, {\n\t\t\t\t\tuser: usersRes.response.find(item => item.id === comment.from_id),\n\t\t\t\t\tcomment,\n\t\t\t\t}\n\t\t\t]), [])\n\t\t\tconsole.log('res', res)\n\n\t\t\tsetComments(res)\n\t\t\tsetLoading(false)\n\t\t}\n\n\t\tfetchData()\n\t}, [])\n\n\tconst popout = loading ? <ScreenSpinner size='large' /> : null\n\n\tconst renderMoreButton = (size) => (\n\t\t<Button\n\t\t\thref='https://vk.com/topic-71768893_30336271'\n\t\t\tsize={ size }\n\t\t\ttarget='_parent'\n\t\t>\n\t\t\tПосмотреть все отзывы\n\t\t</Button>\n\t)\n\n\treturn (\n\t\t<View activePanel='home' popout={ popout }>\n\t\t\t<Panel id='home'>\n\t\t\t\t<PanelHeader>Отзывы от ваших друзей</PanelHeader>\n\t\t\t\t{ comments !== null && comments.length === 0 && (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <Icon56UsersOutline /> }\n\t\t\t\t\t\taction={ renderMoreButton('l') }\n\t\t\t\t\t>\n\t\t\t\t\t\tОтзывов от друзей пока нет\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\n\t\t\t\t{ comments !== null && comments.length > 0 && (\n\t\t\t\t\t<Group\n\t\t\t\t\t\theader={\n\t\t\t\t\t\t\t<Header mode='secondary'>\n\t\t\t\t\t\t\t\tНайдено { comments.length } { pluralForm(['отзыв', 'отзыва', 'отзывов'], comments.length) }\n\t\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<List>\n\t\t\t\t\t\t\t{ comments.map(({ user, comment }) => {\n\t\t\t\t\t\t\t\tconst attachments = (comment.attachments || []).filter(item => item.type === 'photo')\n\t\t\t\t\t\t\t\tconsole.log('att', comment.attachments)\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\t\t\t\tkey={ comment.id }\n\t\t\t\t\t\t\t\t\t\tbefore={\n\t\t\t\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={ user.photo_100 }\n\t\t\t\t\t\t\t\t\t\t\t\tsize={ 50 }\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsize='l'\n\t\t\t\t\t\t\t\t\t\tdescription={\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>{ comment.text }</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.length > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className='attachments'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ attachments.map(attachment => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst size = attachment.photo.sizes.find(item => item.type === 'x')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!size) return null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={ size.url }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth={ size.width / 2 }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\theight={ size.height / 2 }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tmultiline={ true }\n\t\t\t\t\t\t\t\t\t\tbottomContent={\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={ `http://vk.com/topic-71768893_30336271?post=${ comment.id }` }\n\t\t\t\t\t\t\t\t\t\t\t\ttarget='_parent'\n\t\t\t\t\t\t\t\t\t\t\t\tclassName='open-comment'\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tОткрыть\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ user.first_name } { user.last_name }\n\t\t\t\t\t\t\t\t\t</Cell>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}) }\n\t\t\t\t\t\t</List>\n\t\t\t\t\t\t<Div>\n\t\t\t\t\t\t\t{ renderMoreButton('xl') }\n\t\t\t\t\t\t</Div>\n\t\t\t\t\t</Group>\n\t\t\t\t) }\n\t\t\t</Panel>\n\t\t</View>\n\t)\n}\n\nexport default App\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}